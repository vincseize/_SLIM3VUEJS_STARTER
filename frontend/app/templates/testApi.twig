<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <base href="{{ base_url() }}/"/>

    <link rel="shortcut icon" href="{{ base_url() }}/img/favicon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Bootstrap 3.0.2 core CSS -->
    <link href='{{ base_url() }}/css/bootstrap.min.css' rel='stylesheet' type='text/css'>
    <!-- My styles -->
    <link href='{{ base_url() }}/css/my_styles.css' rel='stylesheet' type='text/css'>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" /> -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>
  

</head>
<body>

<!--Header-->
<header>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
            </button>
            <a class="navbar-brand">
                <img style="max-width:32px; margin-top: -7px;"
                     src="{{ base_url() }}/img/favicon.png">
            </a>
            <a class="navbar-brand">SLIM3 TEST API</a>
          </div>
        </div><!-- /.container-fluid -->
      </nav>
</header>

<main>
<div class="container">

    Current time: <font color=silver><i>{{ now }}</i></font>
    <br>

    {% if res_test == 'TRUE' %}
    Connect to API : <font color=green>{{ res_test }}</font>
    {% else %}
    Connect to API : <font color=red>{{ res_test }}</font>
    {% endif %} 

    <br><br>

    <div style="vertical-align:top;margin:0;padding:0;">
        <div style="display:inline-block;vertical-align:top;margin:0;padding:0;">
            <button type="button" class="btn btn-default" onClick="window.location.reload();">
                <i class="fa fa-refresh"></i>
                Refresh</button>
                &nbsp;table <b>{{ table }}</b>
        </div>
    </divstyle="display:inline-block">

    <table id="listquestions" class="table table-striped table-bordered table-hover" cellspacing="0" width="100%">
        <thead>
            <tr>
                {% for key, value in table_fetchAll[0] %}
                    <th>{{ key }}</th>
                {% endfor %}
                <th class="text-center">
                    <!-- &nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" class="checkbox-delete"> -->
                    <div align="center">
                        <button type="button" name="btn_delete" id="btn_delete" class="btn btn-danger">Delete</button>
                        &nbsp;&nbsp;<input type="checkbox" id="btn_delete_all">
                    </div>
                
                </th>
            </tr>
        </thead>
        <tbody> 
            {% for key,values in table_fetchAll %}
            <tr id="{{ values.id }}">
                {% for field, value in values %}
                    <td>
                        <a data-name="{{ field }}" data-type="text" data-pk="{{ values.id }}" data-url="path">
                            {{ value }}
                        </a>
                    </td>
                {% endfor %}
                <td class="text-center">
                    <!-- <font color=red><b>X</b></font> -->
                    <!-- &nbsp;&nbsp;<input type="checkbox" class="checkbox-delete"> -->
                    <input type="checkbox" name="checkbox-delete_{{ values.id }}" class="checkbox-delete" value="{{ values.id }}">
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <!-- <input type='button' value='ADD Fake Entry' onClick='window.location.reload();' style='width:200px'> -->
    <button type="button" name="btn_add_fake" id="btn_add_fake" class="btn btn-primary">ADD Fake Entry</button>

<br>

<!-- 
<div class="d-flex align-items-end">

        <div class="p-2">
            <button type='button' name="btn_search_by" id="btn_search_by" class="btn btn-primary" styleX='width:200px'
            onClick="
            c = document.getElementById('search_select_col_restful');
            var col = c.options[c.selectedIndex].value;
            var search = document.getElementById('search_input_restful').value;
            window.open('api/{{ table }}/search/'+col+'/'+search+'','_blank');
            ">
            RESTFUL SEARCH by
            </button>
        </div>


        <div class="p-2">
            &nbsp;<select name='search_select_col_restful' id='search_select_col_restful' class="form-control">
                {% for key, value in table_fetchAll[0] %}
                    <option>{{ key }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="p-2">
            &nbsp;<input name='search_input_restful' id='search_input_restful' class="form-control" type='text' value='Vincseize'>
        </div>

</div>
 -->














<!-- <div class="row">     -->
        <div class="input-group"> 
            <span class="input-group-btn">
                <button type='button' name="btn_search_by" id="btn_search_by" class="btn btn-default" styleX='width:200px'>
                <i class="fa fa-search"></i>&nbsp;&nbsp;RESTFUL Filter by</span>
                </button>      

                <select name='search_select_col_restful' id='search_select_col_restful' class="form-control" style="width:auto;">
                    {% for key, value in table_fetchAll[0] %}
                        <option>{{ key }}</option>
                    {% endfor %}
                </select>
                <input name='search_input_restful' id='search_input_restful' class="form-control" type='text' value='Miss' style="width:auto;">    
            </span>
        </div>
<!-- </div> -->
















</div>
</main>  

<br><br>

</body>
</html>

<script>
$(document).ready(function(){

    function clear_delete_checkbox(){
        $('.checkbox-delete').each(function(){
            $('.checkbox-delete').prop('checked', false);
        });
        $('#btn_delete_all').prop('checked', false);
    }

    $('#btn_search_by').click(function(){
        // console.log('click');

        c = document.getElementById('search_select_col_restful');
                var col = c.options[c.selectedIndex].value;
                var search = document.getElementById('search_input_restful').value;
                window.open('api/{{ table }}/search/'+col+'/'+search+'','_blank');

    });


    $('#btn_delete').click(function(){
            var ids = [];
            $('.checkbox-delete:checked').each(function(i){
                ids[i] = $(this).val();
            });
            if(ids.length === 0)
            {
                alert("Please Select at least one checkbox");
            } else {

            if(confirm("Are you sure you want to delete this "+ ids +" ?"))
            {
                $.ajax({
                url:'../app/_crud.php',
                method:'POST',
                data:{table:'{{ table }}',ids:ids,crud:'delete'},
                success:function(response)
                {
                    console.log(response);
                    if (response == 'TRUE'){
                        ids.forEach(function(id) {
                            $('tr#'+id+'').css('background-color', 'red');
                            $('tr#'+id+'').fadeOut('slow');
                        });
                        clear_delete_checkbox();
                        setTimeout(function(){ 
                            location.reload(); // optional
                        }, 1000);
                    }
                },
                error: function(err){
                    console.log(err);
                }
                });

            }else{return false;}

        }
    });
 
    $('#btn_delete_all').click(function(){

        if( $('#btn_delete_all').is(':checked') ){
            $('.checkbox-delete').each(function(){
                $('.checkbox-delete').prop('checked', true);
        });

        } else {    
            clear_delete_checkbox();
        }

    });


});
</script>
